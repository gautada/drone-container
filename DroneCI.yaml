kind: pipeline
type: kubernetes
name: Docker Test

steps:
- name: integrate
  image: gautada/builder:v1.21.4_v3.2.3
  privileged: true
  environment:
    DOCKER_USERNAME:
      from_secret: username.docker.io
    DOCKER_PASSWORD:
      from_secret: password.docker.io
    ALPINE_TAG: 3.14.1
    # VERSION_SERVER: v2.1.0
    # VERSION_RUNNER: v1.0.0-beta.9
    # VERSION_CLI: v1.3.3
    OCI_OS: linux
    OCI_ARCH: arm64
  commands:
  - sleep 5
  # - echo $VERSION_SERVER
  #  export OCI_VERSION=$VERSION_SERVER_$VERSION_RUNNER_$VERSION_CLI
  #  echo "${OCI_VERSION"
  # buildah login --username=$DOCKER_USERNAME --password=$DOCKER_PASSWORD docker.io
  # buildah bud --build-arg ALPINE_TAG=$ALPINE_TAG --build-arg BRANCH=$OCI_VERSION --tag localhost/droneci:dev -f Containerfile
  # to-do: run the container, add the tests, then publish
  # buildah push localhost/droneci:dev docker://docker.io/gautada/droneci:$OCI_VERSION
  - buildah images
  



